<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Puter API Explorer</title>
  <style>
    :root { --primary: #6366f1; --dark: #1e293b; }
    body { font-family: 'Inter', system-ui; max-width: 1000px; margin: 0 auto; padding: 2rem; 
           background: #f8fafc; color: var(--dark); }
    .container { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    .panel { background: white; border-radius: 12px; padding: 1.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
    h1 { color: var(--primary); margin-bottom: 1.5rem; }
    textarea { width: 100%; min-height: 150px; padding: 1rem; 
              border: 1px solid #e2e8f0; border-radius: 8px; }
    select { width: 100%; padding: 0.75rem; border-radius: 8px; 
            border: 1px solid #e2e8f0; margin: 0.5rem 0; }
    button { background: var(--primary); color: white; border: none; padding: 0.75rem; 
            border-radius: 8px; cursor: pointer; font-weight: 600; }
    button:hover { opacity: 0.9; }
    #response { min-height: 200px; padding: 1rem; background: #f1f5f9; 
                border-radius: 8px; margin-top: 1rem; white-space: pre-wrap; }
    .model-card { border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; 
                 margin-bottom: 1rem; cursor: pointer; transition: all 0.2s; }
    .model-card:hover { border-color: var(--primary); }
    .selected { border-color: var(--primary); background: #eef2ff; }
    .status { padding: 0.5rem; border-radius: 6px; margin-top: 0.5rem; }
    .success { background: #dcfce7; color: #166534; }
    .error { background: #fee2e2; color: #b91c1c; }
    .history-item { border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; 
                  margin-bottom: 0.5rem; cursor: pointer; }
    .history-item:hover { background: #f1f5f9; }
    .history-header { display: flex; justify-content: space-between; align-items: center; }
    .clear-history { background: #ef4444; padding: 0.25rem 0.5rem; font-size: 0.85rem; }
  </style>
</head>
<body>
  <h1>Puter API Explorer</h1>
  
  <div class="container">
    <div class="panel">
      <h2>Request</h2>
      <select id="framework">
        <option value="react">React</option>
        <option value="nextjs">Next.js</option>
        <option value="angular">Angular</option>
        <option value="vue">Vue.js</option>
        <option value="svelte">Svelte</option>
        <option value="astro">Astro</option>
      </select>
      
      <div id="models-container">
        <!-- Models will be populated here -->
      </div>
      
      <textarea id="prompt" placeholder="Enter your prompt..."></textarea>
      <button onclick="submitRequest()">Send Request</button>
    </div>
    
    <div class="panel">
      <h2>Response</h2>
      <div id="response">API response will appear here...</div>
    </div>

    <div class="panel" style="grid-column: 1 / -1;">
      <div class="history-header">
        <h2>Request History</h2>
        <button class="clear-history" onclick="clearHistory()">Clear</button>
      </div>
      <div id="history-container"></div>
    </div>
  </div>

  <script>
    // Framework-specific models
    const MODELS = {
      react: ['react-basic', 'react-pro', 'react-streaming'],
      nextjs: ['next-ssr', 'next-api', 'next-edge'],
      angular: ['angular-ivy', 'angular-standalone'],
      vue: ['vue-3', 'vue-2-compat'],
      svelte: ['svelte-4', 'svelte-5-alpha'],
      astro: ['astro-3', 'astro-content']
    };

    // Initialize UI
    document.addEventListener('DOMContentLoaded', () => {
      populateModels();
      document.getElementById('framework').addEventListener('change', populateModels);
      loadHistory();
    });

    function populateModels() {
      const framework = document.getElementById('framework').value;
      const container = document.getElementById('models-container');
      container.innerHTML = '';
      
      MODELS[framework].forEach((model, index) => {
        const card = document.createElement('div');
        card.className = 'model-card' + (index === 0 ? ' selected' : '');
        card.dataset.model = model;
        card.innerHTML = `<strong>${model}</strong><br>
                          Framework: ${framework}<br>
                          Latency: ~${50 + index*30}ms`;
        
        card.addEventListener('click', () => {
          document.querySelectorAll('.model-card').forEach(c => 
            c.classList.remove('selected'));
          card.classList.add('selected');
        });
        
        container.appendChild(card);
      });
    }

    async function submitRequest() {
      const framework = document.getElementById('framework').value;
      const selectedModel = document.querySelector('.model-card.selected');
      const prompt = document.getElementById('prompt').value;
      const responseDiv = document.getElementById('response');
      const timestamp = Date.now();
      
      if (!prompt) {
        responseDiv.innerHTML = '<div class="status error">‚ö†Ô∏è Please enter a prompt</div>';
        return;
      }

      responseDiv.innerHTML = '<div class="status">üîÑ Processing request...</div>';
      
      try {
        const model = selectedModel ? selectedModel.dataset.model : MODELS[framework][0];
        
        // Send request to backend proxy
        const apiResponse = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ model, prompt })
        });

        if (!apiResponse.ok) {
          const error = await apiResponse.json();
          throw new Error(error.error || 'API request failed');
        }

        const { response } = await apiResponse.json();
        
        // Save to history
        saveToHistory({
          framework,
          model,
          prompt,
          timestamp
        }, response);

        // Display response
        responseDiv.innerHTML = `
          <div class="status success">‚úÖ Success (200) - ${new Date(timestamp).toLocaleTimeString()}</div>
          <strong>Framework:</strong> ${framework}<br>
          <strong>Model:</strong> ${model}<br>
          <strong>Prompt:</strong> ${prompt.substring(0, 100)}${prompt.length > 100 ? '...' : ''}<br><br>
          <strong>Response:</strong><br>
          ${response}
        `;
      } catch (error) {
        responseDiv.innerHTML = `
          <div class="status error">‚ùå Error</div>
          <strong>Message:</strong> ${error.message}
        `;
      }
    }

    function saveToHistory(request, response) {
      let history = JSON.parse(localStorage.getItem('puter_history') || '[]');
      history.unshift({ request, response });
      // Keep last 10 entries
      if (history.length > 10) history.pop();
      localStorage.setItem('puter_history', JSON.stringify(history));
      loadHistory();
    }

    function loadHistory() {
      const container = document.getElementById('history-container');
      const history = JSON.parse(localStorage.getItem('puter_history') || '[]');
      
      if (history.length === 0) {
        container.innerHTML = '<div class="status">No requests yet - try sending your first request!</div>';
        return;
      }
      
      container.innerHTML = history.map((item, index) => `
        <div class="history-item" onclick="replayRequest(${index})">
          <div style="font-weight: 600; margin-bottom: 0.25rem;">
            ${item.request.prompt.substring(0, 60)}${item.request.prompt.length > 60 ? '...' : ''}
          </div>
          <div style="display: flex; justify-content: space-between; color: #64748b; font-size: 0.85rem;">
            <span>${item.request.framework} ‚Ä¢ ${item.request.model}</span>
            <span>${new Date(item.request.timestamp).toLocaleTimeString()}</span>
          </div>
        </div>
      `).join('');
    }

    function replayRequest(index) {
      const history = JSON.parse(localStorage.getItem('puter_history') || '[]');
      if (index < history.length) {
        const item = history[index];
        document.getElementById('prompt').value = item.request.prompt;
        
        // Select the correct framework
        document.getElementById('framework').value = item.request.framework;
        populateModels();
        
        // Select the correct model
        setTimeout(() => {
          const modelCards = document.querySelectorAll('.model-card');
          modelCards.forEach(card => {
            if (card.dataset.model === item.request.model) {
              card.click();
            }
          });
        }, 50);
      }
    }

    function clearHistory() {
      localStorage.removeItem('puter_history');
      loadHistory();
    }
  </script>
</body>
</html>